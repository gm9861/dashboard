<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ¯ é¡¹ç›®ç®¡ç†ç³»ç»Ÿ - Dashboard</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
            min-height: 100vh;
            color: white;
            padding: 20px;
        }
        .header {
            text-align: center;
            padding: 30px 0;
            margin-bottom: 30px;
        }
        .header h1 {
            font-size: 2.5rem;
            background: linear-gradient(90deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 10px;
        }
        .header p {
            color: rgba(255,255,255,0.6);
        }
        .nav {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-bottom: 30px;
        }
        .nav-btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1rem;
            transition: all 0.3s;
            background: rgba(255,255,255,0.1);
            color: white;
        }
        .nav-btn:hover, .nav-btn.active {
            background: linear-gradient(90deg, #667eea, #764ba2);
        }
        .tab-content { display: none; }
        .tab-content.active { display: block; }
        
        /* çœ‹æ¿æ ·å¼ */
        .board {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            max-width: 1400px;
            margin: 0 auto;
        }
        .column {
            background: rgba(255,255,255,0.05);
            border-radius: 12px;
            padding: 20px;
            min-height: 400px;
        }
        .column h3 {
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 15px;
            text-align: center;
            font-size: 1.1rem;
        }
        .column-todo h3 { background: linear-gradient(90deg, #ff6b6b, #ee5a24); }
        .column-progress h3 { background: linear-gradient(90deg, #feca57, #ff9f43); }
        .column-done h3 { background: linear-gradient(90deg, #00c853, #009624); }
        
        .task {
            background: rgba(255,255,255,0.08);
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 10px;
            cursor: grab;
            transition: all 0.3s;
            border-left: 4px solid #667eea;
        }
        .task:hover {
            background: rgba(255,255,255,0.12);
            transform: translateY(-2px);
        }
        .task-title {
            font-weight: 600;
            margin-bottom: 8px;
        }
        .task-meta {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 0.85rem;
            color: rgba(255,255,255,0.5);
        }
        .task-priority {
            padding: 3px 8px;
            border-radius: 4px;
            font-size: 0.75rem;
        }
        .priority-high { background: #ff1744; }
        .priority-medium { background: #ff9100; }
        .priority-low { background: #00c853; }
        
        .add-task {
            width: 100%;
            padding: 12px;
            border: 2px dashed rgba(255,255,255,0.3);
            border-radius: 8px;
            background: transparent;
            color: rgba(255,255,255,0.5);
            cursor: pointer;
            transition: all 0.3s;
        }
        .add-task:hover {
            border-color: #667eea;
            color: #667eea;
        }
        
        /* ç»Ÿè®¡å¡ç‰‡ */
        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            max-width: 1200px;
            margin: 0 auto 30px;
        }
        .stat-card {
            background: rgba(255,255,255,0.05);
            border-radius: 12px;
            padding: 25px;
            text-align: center;
        }
        .stat-value {
            font-size: 2.5rem;
            font-weight: bold;
            background: linear-gradient(90deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        .stat-label {
            color: rgba(255,255,255,0.6);
            margin-top: 5px;
        }
        
        /* é‡Œç¨‹ç¢‘ */
        .milestones {
            max-width: 1200px;
            margin: 0 auto;
        }
        .milestone {
            display: flex;
            align-items: center;
            padding: 15px;
            background: rgba(255,255,255,0.05);
            border-radius: 8px;
            margin-bottom: 10px;
        }
        .milestone-check {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            border: 2px solid #667eea;
            margin-right: 15px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
        }
        .milestone.completed .milestone-check {
            background: #00c853;
            border-color: #00c853;
        }
        .milestone.completed .milestone-check::after {
            content: 'âœ“';
            color: white;
        }
        .milestone-title {
            flex: 1;
        }
        .milestone-date {
            color: rgba(255,255,255,0.5);
            font-size: 0.9rem;
        }
        
        /* æ¨¡æ€æ¡† */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.7);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }
        .modal.active { display: flex; }
        .modal-content {
            background: #1a1a2e;
            border-radius: 12px;
            padding: 30px;
            width: 90%;
            max-width: 500px;
        }
        .modal-title {
            font-size: 1.5rem;
            margin-bottom: 20px;
        }
        .form-group {
            margin-bottom: 20px;
        }
        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: rgba(255,255,255,0.7);
        }
        .form-group input, .form-group select, .form-group textarea {
            width: 100%;
            padding: 12px;
            border: 1px solid rgba(255,255,255,0.2);
            border-radius: 8px;
            background: rgba(255,255,255,0.05);
            color: white;
            font-size: 1rem;
        }
        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1rem;
            transition: all 0.3s;
            margin-right: 10px;
        }
        .btn-primary {
            background: linear-gradient(90deg, #667eea, #764ba2);
            color: white;
        }
        .btn-secondary {
            background: rgba(255,255,255,0.1);
            color: white;
        }
        .btn:hover { transform: translateY(-2px); }
        
        /* é¡¹ç›®åˆ—è¡¨ */
        .project-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            max-width: 1200px;
            margin: 0 auto;
        }
        .project-card {
            background: rgba(255,255,255,0.05);
            border-radius: 12px;
            padding: 25px;
            cursor: pointer;
            transition: all 0.3s;
            border: 2px solid transparent;
        }
        .project-card:hover {
            border-color: #667eea;
            transform: translateY(-5px);
        }
        .project-card h3 {
            margin-bottom: 10px;
        }
        .project-card p {
            color: rgba(255,255,255,0.6);
            font-size: 0.9rem;
        }
        .project-progress {
            margin-top: 15px;
            height: 6px;
            background: rgba(255,255,255,0.1);
            border-radius: 3px;
            overflow: hidden;
        }
        .project-progress-bar {
            height: 100%;
            background: linear-gradient(90deg, #667eea, #764ba2);
            border-radius: 3px;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>ğŸ¯ é¡¹ç›®ç®¡ç†ç³»ç»Ÿ</h1>
        <p>Dashboard é…å¥—é¡¹ç›® Â· æ•°æ®æœ¬åœ°å­˜å‚¨</p>
    </div>
    
    <div class="nav">
        <button class="nav-btn active" onclick="showTab('projects')">ğŸ“ é¡¹ç›®</button>
        <button class="nav-btn" onclick="showTab('board')">ğŸ“‹ çœ‹æ¿</button>
        <button class="nav-btn" onclick="showTab('stats')">ğŸ“Š ç»Ÿè®¡</button>
    </div>
    
    <!-- é¡¹ç›®åˆ—è¡¨ -->
    <div id="projects" class="tab-content active">
        <div class="project-grid" id="projectList"></div>
        <button class="add-task" onclick="showModal()" style="margin-top: 20px; max-width: 1200px;">+ æ·»åŠ æ–°é¡¹ç›®</button>
    </div>
    
    <!-- çœ‹æ¿ -->
    <div id="board" class="tab-content">
        <div style="text-align: center; margin-bottom: 20px;">
            <select id="projectSelect" onchange="loadProject()" style="padding: 10px 20px; border-radius: 8px; background: rgba(255,255,255,0.1); color: white; border: 1px solid rgba(255,255,255,0.2);">
                <option value="">é€‰æ‹©é¡¹ç›®...</option>
            </select>
        </div>
        <div class="board" id="kanbanBoard" style="display: none;">
            <div class="column column-todo">
                <h3>ğŸ“ å¾…åŠ</h3>
                <div id="todoTasks"></div>
                <button class="add-task" onclick="addTask('todo')">+ æ·»åŠ ä»»åŠ¡</button>
            </div>
            <div class="column column-progress">
                <h3>ğŸ”¥ è¿›è¡Œä¸­</h3>
                <div id="progressTasks"></div>
                <button class="add-task" onclick="addTask('progress')">+ æ·»åŠ ä»»åŠ¡</button>
            </div>
            <div class="column column-done">
                <h3>âœ… å·²å®Œæˆ</h3>
                <div id="doneTasks"></div>
                <button class="add-task" onclick="addTask('done')">+ æ·»åŠ ä»»åŠ¡</button>
            </div>
        </div>
    </div>
    
    <!-- ç»Ÿè®¡ -->
    <div id="stats" class="tab-content">
        <div class="stats">
            <div class="stat-card">
                <div class="stat-value" id="totalProjects">0</div>
                <div class="stat-label">é¡¹ç›®æ€»æ•°</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="totalTasks">0</div>
                <div class="stat-label">ä»»åŠ¡æ€»æ•°</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="completedTasks">0</div>
                <div class="stat-label">å·²å®Œæˆ</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="completionRate">0%</div>
                <div class="stat-label">å®Œæˆç‡</div>
            </div>
        </div>
        <div class="milestones">
            <h2 style="margin-bottom: 20px;">ğŸ¯ é‡Œç¨‹ç¢‘</h2>
            <div id="milestoneList"></div>
            <button class="add-task" onclick="addMilestone()" style="margin-top: 15px;">+ æ·»åŠ é‡Œç¨‹ç¢‘</button>
        </div>
    </div>
    
    <!-- æ·»åŠ é¡¹ç›®æ¨¡æ€æ¡† -->
    <div class="modal" id="projectModal">
        <div class="modal-content">
            <h3 class="modal-title">æ·»åŠ æ–°é¡¹ç›®</h3>
            <div class="form-group">
                <label>é¡¹ç›®åç§°</label>
                <input type="text" id="projectName" placeholder="è¾“å…¥é¡¹ç›®åç§°">
            </div>
            <div class="form-group">
                <label>é¡¹ç›®æè¿°</label>
                <textarea id="projectDesc" rows="3" placeholder="æè¿°é¡¹ç›®ç›®æ ‡"></textarea>
            </div>
            <div class="form-group">
                <label>æˆªæ­¢æ—¥æœŸï¼ˆå¯é€‰ï¼‰</label>
                <input type="date" id="projectDeadline">
            </div>
            <button class="btn btn-primary" onclick="createProject()">åˆ›å»ºé¡¹ç›®</button>
            <button class="btn btn-secondary" onclick="closeModal()">å–æ¶ˆ</button>
        </div>
    </div>
    
    <!-- æ·»åŠ ä»»åŠ¡æ¨¡æ€æ¡† -->
    <div class="modal" id="taskModal">
        <div class="modal-content">
            <h3 class="modal-title">æ·»åŠ ä»»åŠ¡</h3>
            <div class="form-group">
                <label>ä»»åŠ¡åç§°</label>
                <input type="text" id="taskName" placeholder="è¾“å…¥ä»»åŠ¡åç§°">
            </div>
            <div class="form-group">
                <label>ä¼˜å…ˆçº§</label>
                <select id="taskPriority">
                    <option value="low">ğŸŸ¢ ä½</option>
                    <option value="medium" selected>ğŸŸ¡ ä¸­</option>
                    <option value="high">ğŸ”´ é«˜</option>
                </select>
            </div>
            <div class="form-group">
                <label>æˆªæ­¢æ—¥æœŸï¼ˆå¯é€‰ï¼‰</label>
                <input type="date" id="taskDeadline">
            </div>
            <button class="btn btn-primary" onclick="createTask()">æ·»åŠ ä»»åŠ¡</button>
            <button class="btn btn-secondary" onclick="closeTaskModal()">å–æ¶ˆ</button>
        </div>
    </div>
    
    <!-- æ·»åŠ é‡Œç¨‹ç¢‘æ¨¡æ€æ¡† -->
    <div class="modal" id="milestoneModal">
        <div class="modal-content">
            <h3 class="modal-title">æ·»åŠ é‡Œç¨‹ç¢‘</h3>
            <div class="form-group">
                <label>é‡Œç¨‹ç¢‘åç§°</label>
                <input type="text" id="milestoneName" placeholder="è¾“å…¥é‡Œç¨‹ç¢‘">
            </div>
            <div class="form-group">
                <label>ç›®æ ‡æ—¥æœŸ</label>
                <input type="date" id="milestoneDate">
            </div>
            <button class="btn btn-primary" onclick="createMilestone()">æ·»åŠ </button>
            <button class="btn btn-secondary" onclick="closeMilestoneModal()">å–æ¶ˆ</button>
        </div>
    </div>

    <script>
        // æ•°æ®å­˜å‚¨
        const STORAGE_KEY = 'dashboard_project_system';
        let projects = JSON.parse(localStorage.getItem(STORAGE_KEY) || '{}');
        let milestones = JSON.parse(localStorage.getItem(STORAGE_KEY + '_milestones') || '[]');
        let currentProject = null;
        let currentColumn = null;

        // åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', () => {
            renderProjects();
            renderStats();
            renderMilestones();
            loadProjectSelect();
        });

        // æ ‡ç­¾åˆ‡æ¢
        function showTab(tab) {
            document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
            document.getElementById(tab).classList.add('active');
            event.target.classList.add('active');
        }

        // æ¸²æŸ“é¡¹ç›®åˆ—è¡¨
        function renderProjects() {
            const list = document.getElementById('projectList');
            list.innerHTML = Object.values(projects).map(p => {
                const taskCount = Object.values(p.tasks || {}).length;
                const doneCount = Object.values(p.tasks || {}).filter(t => t.status === 'done').length;
                const progress = taskCount ? Math.round(doneCount / taskCount * 100) : 0;
                return `
                    <div class="project-card" onclick="selectProject('${p.id}')">
                        <h3>${p.name}</h3>
                        <p>${p.desc || 'æš‚æ— æè¿°'}</p>
                        <div class="project-progress">
                            <div class="project-progress-bar" style="width: ${progress}%"></div>
                        </div>
                        <p style="margin-top: 10px; font-size: 0.8rem;">
                            ${taskCount}ä¸ªä»»åŠ¡ Â· ${progress}%å®Œæˆ
                        </p>
                    </div>
                `;
            }).join('');
        }

        // åŠ è½½é¡¹ç›®é€‰æ‹©å™¨
        function loadProjectSelect() {
            const select = document.getElementById('projectSelect');
            select.innerHTML = '<option value="">é€‰æ‹©é¡¹ç›®...</option>' + 
                Object.values(projects).map(p => `<option value="${p.id}">${p.name}</option>`).join('');
        }

        // é€‰æ‹©é¡¹ç›®
        function selectProject(id) {
            currentProject = id;
            document.getElementById('projectSelect').value = id;
            loadProject();
        }

        // åŠ è½½é¡¹ç›®çœ‹æ¿
        function loadProject() {
            const projectId = document.getElementById('projectSelect').value;
            if (!projectId) {
                document.getElementById('kanbanBoard').style.display = 'none';
                return;
            }
            document.getElementById('kanbanBoard').style.display = 'grid';
            renderTasks();
        }

        // æ¸²æŸ“ä»»åŠ¡
        function renderTasks() {
            const project = projects[currentProject];
            if (!project) return;
            
            ['todo', 'progress', 'done'].forEach(status => {
                const tasks = Object.values(project.tasks || {}).filter(t => t.status === status);
                const container = document.getElementById(status + 'Tasks');
                container.innerHTML = tasks.map((t, i) => `
                    <div class="task" draggable="true" ondragstart="drag(event, '${t.id}')">
                        <div class="task-title">${t.name}</div>
                        <div class="task-meta">
                            <span class="task-priority priority-${t.priority}">
                                ${t.priority === 'high' ? 'ğŸ”´é«˜' : t.priority === 'medium' ? 'ğŸŸ¡ä¸­' : 'ğŸŸ¢ä½'}
                            </span>
                            <span>${t.deadline || ''}</span>
                        </div>
                    </div>
                `).join('');
            });
        }

        // åˆ›å»ºé¡¹ç›®
        function createProject() {
            const name = document.getElementById('projectName').value;
            const desc = document.getElementById('projectDesc').value;
            const deadline = document.getElementById('projectDeadline').value;
            
            if (!name) return alert('è¯·è¾“å…¥é¡¹ç›®åç§°');
            
            const id = 'proj_' + Date.now();
            projects[id] = {
                id,
                name,
                desc,
                deadline,
                tasks: {},
                createdAt: new Date().toISOString()
            };
            
            saveData();
            renderProjects();
            loadProjectSelect();
            closeModal();
        }

        // æ·»åŠ ä»»åŠ¡
        function addTask(column) {
            currentColumn = column;
            document.getElementById('taskModal').classList.add('active');
        }

        function createTask() {
            const name = document.getElementById('taskName').value;
            const priority = document.getElementById('taskPriority').value;
            const deadline = document.getElementById('taskDeadline').value;
            
            if (!name || !currentProject) return alert('è¯·è¾“å…¥ä»»åŠ¡åç§°å¹¶é€‰æ‹©é¡¹ç›®');
            
            const taskId = 'task_' + Date.now();
            if (!projects[currentProject].tasks) projects[currentProject].tasks = {};
            
            projects[currentProject].tasks[taskId] = {
                id: taskId,
                name,
                priority,
                deadline,
                status: currentColumn,
                createdAt: new Date().toISOString()
            };
            
            saveData();
            renderTasks();
            renderStats();
            closeTaskModal();
        }

        // é‡Œç¨‹ç¢‘
        function renderMilestones() {
            const list = document.getElementById('milestoneList');
            list.innerHTML = milestones.map(m => `
                <div class="milestone ${m.completed ? 'completed' : ''}" onclick="toggleMilestone('${m.id}')">
                    <div class="milestone-check"></div>
                    <div class="milestone-title">${m.name}</div>
                    <div class="milestone-date">${m.date}</div>
                </div>
            `).join('');
        }

        function addMilestone() {
            document.getElementById('milestoneModal').classList.add('active');
        }

        function createMilestone() {
            const name = document.getElementById('milestoneName').value;
            const date = document.getElementById('milestoneDate').value;
            if (!name) return alert('è¯·è¾“å…¥é‡Œç¨‹ç¢‘åç§°');
            
            milestones.push({
                id: 'ms_' + Date.now(),
                name,
                date,
                completed: false
            });
            
            localStorage.setItem(STORAGE_KEY + '_milestones', JSON.stringify(milestones));
            renderMilestones();
            closeMilestoneModal();
        }

        function toggleMilestone(id) {
            const m = milestones.find(m => m.id === id);
            if (m) {
                m.completed = !m.completed;
                localStorage.setItem(STORAGE_KEY + '_milestones', JSON.stringify(milestones));
                renderMilestones();
            }
        }

        // ç»Ÿè®¡
        function renderStats() {
            const projectList = Object.values(projects);
            const totalProjects = projectList.length;
            const allTasks = projectList.flatMap(p => Object.values(p.tasks || {}));
            const totalTasks = allTasks.length;
            const completedTasks = allTasks.filter(t => t.status === 'done').length;
            const rate = totalTasks ? Math.round(completedTasks / totalTasks * 100) : 0;
            
            document.getElementById('totalProjects').textContent = totalProjects;
            document.getElementById('totalTasks').textContent = totalTasks;
            document.getElementById('completedTasks').textContent = completedTasks;
            document.getElementById('completionRate').textContent = rate + '%';
        }

        // æ‹–æ‹½
        function drag(e, taskId) {
            e.dataTransfer.setData('taskId', taskId);
        }

        document.addEventListener('dragover', e => e.preventDefault());
        document.addEventListener('drop', e => {
            e.preventDefault();
            const taskId = e.dataTransfer.getData('taskId');
            const column = e.target.closest('.column');
            if (column && currentProject) {
                const newStatus = column.className.includes('todo') ? 'todo' : 
                                column.className.includes('progress') ? 'progress' : 'done';
                if (projects[currentProject].tasks[taskId]) {
                    projects[currentProject].tasks[taskId].status = newStatus;
                    saveData();
                    renderTasks();
                    renderStats();
                }
            }
        });

        // æ¨¡æ€æ¡†æ§åˆ¶
        function showModal() { document.getElementById('projectModal').classList.add('active'); }
        function closeModal() { document.getElementById('projectModal').classList.remove('active'); }
        function closeTaskModal() { document.getElementById('taskModal').classList.remove('active'); }
        function closeMilestoneModal() { document.getElementById('milestoneModal').classList.remove('active'); }

        function saveData() {
            localStorage.setItem(STORAGE_KEY, JSON.stringify(projects));
        }
    </script>
</body>
</html>
