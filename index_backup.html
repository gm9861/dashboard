<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åŠ å¯†è´§å¸äº¤æ˜“åŠ©æ‰‹ - èˆ†æƒ…ç³»ç»Ÿ</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; background: linear-gradient(135deg, #0d0d1a 0%, #1a1a2e 100%); min-height: 100vh; padding: 20px; color: #fff; }
        .container { max-width: 1400px; margin: 0 auto; }
        h1 { text-align: center; margin-bottom: 30px; font-size: 2rem; }
        
        .tabs { display: flex; gap: 10px; margin-bottom: 30px; flex-wrap: wrap; justify-content: center; }
        .tab-btn { padding: 12px 20px; background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2); border-radius: 25px; color: rgba(255,255,255,0.8); cursor: pointer; transition: all 0.3s; }
        .tab-btn:hover, .tab-btn.active { background: linear-gradient(135deg, #667eea, #764ba2); border-color: transparent; color: #fff; }
        .tab-content { display: none; animation: fadeIn 0.5s; }
        .tab-content.active { display: block; }
        
        .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; margin-bottom: 30px; }
        .card { background: rgba(255,255,255,0.08); backdrop-filter: blur(10px); border-radius: 20px; padding: 25px; border: 1px solid rgba(255,255,255,0.15); }
        .card:hover { transform: translateY(-3px); }
        
        .fear-gauge { text-align: center; padding: 20px; }
        .fear-value { font-size: 4rem; font-weight: bold; }
        .fear-value.high { color: #00c853; }
        .fear-value.medium { color: #ffab00; }
        .fear-value.low { color: #ff1744; }
        .fear-label { font-size: 1.5rem; margin: 10px 0; }
        .fear-desc { color: rgba(255,255,255,0.6); }
        
        .metric-row { display: flex; justify-content: space-between; padding: 12px 0; border-bottom: 1px solid rgba(255,255,255,0.1); }
        .metric-row:last-child { border-bottom: none; }
        .metric-label { color: rgba(255,255,255,0.7); }
        .metric-value { font-weight: bold; }
        .metric-value.up { color: #00c853; }
        .metric-value.down { color: #ff1744; }
        
        .section-title { font-size: 1.3rem; margin-bottom: 20px; display: flex; align-items: center; gap: 10px; }
        
        .twitter-sentiment { display: grid; gap: 15px; }
        .sentiment-item { background: rgba(255,255,255,0.05); border-radius: 12px; padding: 15px; border-left: 4px solid; }
        .sentiment-item.positive { border-color: #00c853; }
        .sentiment-item.negative { border-color: #ff1744; }
        .sentiment-item.neutral { border-color: #ffab00; }
        .sentiment-score { font-size: 2rem; font-weight: bold; }
        .sentiment-keyword { display: flex; flex-wrap: wrap; gap: 8px; margin-top: 10px; }
        .keyword { padding: 4px 12px; background: rgba(102,126,234,0.3); border-radius: 15px; font-size: 0.85rem; }
        
        .whale-item { display: flex; align-items: center; gap: 15px; padding: 15px; background: rgba(255,255,255,0.05); border-radius: 12px; margin-bottom: 10px; }
        .whale-direction { padding: 8px 15px; border-radius: 20px; font-weight: bold; }
        .whale-direction.accumulate { background: rgba(0,200,83,0.3); color: #00c853; }
        .whale-direction.distribute { background: rgba(255,23,68,0.3); color: #ff1744; }
        
        .exchange-flow { display: flex; align-items: center; gap: 20px; }
        .flow-arrow { font-size: 2rem; }
        .flow-amount { font-size: 1.5rem; font-weight: bold; }
        
        .loading { text-align: center; color: rgba(255,255,255,0.6); padding: 30px; }
        
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ’° åŠ å¯†è´§å¸äº¤æ˜“åŠ©æ‰‹ - èˆ†æƒ…ç³»ç»Ÿ</h1>
        
        <div class="tabs">
            <button class="tab-btn active" onclick="showTab('dashboard', event)">ğŸ“Š ä»ªè¡¨ç›˜</button>
            <button class="tab-btn" onclick="showTab('sentiment', event)">ğŸ˜° èˆ†æƒ…</button>
            <button class="tab-btn" onclick="showTab('onchain', event)">â›“ï¸ é“¾ä¸Š</button>
            <button class="tab-btn" onclick="showTab('whales', event)">ğŸ‹ å·¨é²¸</button>
            <button class="tab-btn" onclick="showTab('twitter', event)">ğŸ¦ Twitter</button>
            <button class="tab-btn" onclick="showTab('positions', event)">ğŸ’¼ æŒä»“</button>
        </div>
        
        <!-- ä»ªè¡¨ç›˜ -->
        <!-- ä»ªè¡¨ç›˜ - ç²¾ç®€ç‰ˆ -->
        <div id="dashboard" class="tab-content active">
            <div class="grid">
                <!-- æ ¸å¿ƒæŒ‡æ ‡åŒº -->
                <div class="card" style="grid-column: span 2;">
                    <h3 class="section-title">ğŸ’° BTC ä»·æ ¼</h3>
                    <div style="text-align: center;">
                        <div id="btc-price-main" style="font-size: 3rem; font-weight: bold; color: #667eea;">---</div>
                        <p style="color: rgba(255,255,255,0.5); font-size: 0.9rem; margin-top: 5px;">å®æ—¶ä»·æ ¼ Â· CoinGecko</p>
                    </div>
                </div>
                
                <!-- AHR999 -->
                <div class="card">
                    <h3 class="section-title">ğŸ¯ AHR999</h3>
                    <div style="text-align: center;">
                        <div id="ahr999-main" style="font-size: 2.5rem; font-weight: bold; color: #667eea;">1.53</div>
                        <div id="ahr999-zone-main" style="padding: 8px 20px; border-radius: 20px; display: inline-block; margin-top: 10px; background: rgba(102,126,234,0.3); color: #667eea;">ğŸ“ˆ ç‰›å¸‚</div>
                    </div>
                </div>
                
                <!-- ææƒ§è´ªå©ª -->
                <div class="card">
                    <h3 class="section-title">ğŸ˜° ææƒ§è´ªå©ª</h3>
                    <div style="text-align: center;">
                        <div id="fng-main" style="font-size: 2.5rem; font-weight: bold;">--</div>
                        <div id="fng-label-main" style="color: rgba(255,255,255,0.6); margin-top: 5px;">åŠ è½½ä¸­...</div>
                    </div>
                </div>
                
                <!-- äº¤æ˜“æ‰€èµ„é‡‘ -->
                <div class="card" style="grid-column: span 2;">
                    <h3 class="section-title">ğŸ’¹ äº¤æ˜“æ‰€èµ„é‡‘</h3>
                    <div id="exchange-flow-main" style="text-align: center;">
                        <div class="loading">åŠ è½½ä¸­...</div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- èˆ†æƒ…åˆ†æ -->
        <div id="sentiment" class="tab-content">
            <div class="grid">
                <!-- æƒ…ç»ªçƒ­åŠ›å›¾ -->
                <div class="card" style="grid-column: span 2;">
                    <h3 class="section-title">ğŸŒ¡ï¸ æƒ…ç»ªçƒ­åŠ›å›¾</h3>
                    <div id="sentiment-heatmap" style="padding: 20px; text-align: center;">
                        <div style="display: flex; flex-wrap: wrap; gap: 10px; justify-content: center; margin-bottom: 20px;" id="heatmap-container">
                            <span class="keyword" style="font-size: 0.9rem; padding: 8px 15px; background: rgba(102,126,234,0.3); border-radius: 20px;">åŠ è½½ä¸­...</span>
                        </div>
                        <div style="margin-top: 20px; padding: 15px; background: rgba(0,0,0,0.2); border-radius: 10px;">
                            <div style="display: flex; justify-content: space-between; align-items: center;">
                                <span style="color: #ff1744;">ğŸ˜° ææƒ§</span>
                                <div style="flex: 1; height: 8px; background: linear-gradient(to right, #ff1744, #ffab00, #00c853); border-radius: 4px; margin: 0 15px;"></div>
                                <span style="color: #00c853;">è´ªå©ª ğŸ“ˆ</span>
                            </div>
                            <div id="sentiment-meter" style="text-align: center; margin-top: 10px; font-size: 1.5rem; font-weight: bold;">åŠ è½½ä¸­...</div>
                        </div>
                    </div>
                </div>
                
                <!-- æƒ…ç»ªè¶‹åŠ¿å›¾ -->
                <div class="card" style="grid-column: span 2;">
                    <h3 class="section-title">ğŸ“ˆ æƒ…ç»ªè¶‹åŠ¿ (7å¤©)</h3>
                    <div id="sentiment-chart" style="height: 200px; display: flex; align-items: end; gap: 8px; justify-content: center; padding: 20px;"></div>
                </div>
            </div>
        </div>
        
        <!-- é“¾ä¸Šæ•°æ® -->
        <div id="onchain" class="tab-content">
            <div class="grid">
                <div class="card">
                    <h3 class="section-title">ğŸ“Š BTC æ´»è·ƒåœ°å€</h3>
                    <div id="active-addresses">
                        <div class="loading">åŠ è½½ä¸­...</div>
                    </div>
                </div>
                <div class="card">
                    <h3 class="section-title">ğŸ’° äº¤æ˜“æ‰€å‚¨å¤‡</h3>
                    <div id="exchange-reserves">
                        <div class="loading">åŠ è½½ä¸­...</div>
                    </div>
                </div>
                <div class="card">
                    <h3 class="section-title">ğŸ“‰ äº¤æ˜“æ‰€æµå…¥/æµå‡º</h3>
                    <div id="exchange-flow-detail">
                        <div class="loading">åŠ è½½ä¸­...</div>
                    </div>
                </div>
                <div class="card">
                    <h3 class="section-title">ğŸ’ å·¨é²¸åœ°å€æ•°</h3>
                    <div id="whale-count">
                        <div class="loading">åŠ è½½ä¸­...</div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- å·¨é²¸è¿½è¸ª -->
        <div id="whales" class="tab-content">
            <div class="grid">
                <div class="card">
                    <h3 class="section-title">ğŸ‹ å¤§æˆ·æŒä»“å˜åŒ–</h3>
                    <div id="whale-holdings">
                        <div class="loading">åŠ è½½ä¸­...</div>
                    </div>
                </div>
                <div class="card">
                    <h3 class="section-title">ğŸ“Š å·¨é²¸äº¤æ˜“ç»Ÿè®¡</h3>
                    <div id="whale-stats">
                        <div class="loading">åŠ è½½ä¸­...</div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Twitter -->
        <div id="twitter" class="tab-content">
            <div class="card">
                <h3 class="section-title">ğŸ¦ Twitter èˆ†æƒ…ç›‘æ§</h3>
                <div style="display: flex; gap: 10px; margin-bottom: 20px;">
                    <input type="text" id="twitter-user" placeholder="è¾“å…¥ç”¨æˆ·å (å¦‚: elonmusk)" style="flex: 1; padding: 12px 20px; border: 1px solid rgba(255,255,255,0.2); border-radius: 25px; background: rgba(255,255,255,0.1); color: #fff;">
                    <button onclick="searchTwitter()" style="padding: 12px 25px; background: linear-gradient(135deg, #1da1f2, #0d8ecf); border: none; border-radius: 25px; color: white; cursor: pointer;">ğŸ”</button>
                </div>
                <div class="preset-btns" style="margin-bottom: 20px;">
                    <button onclick="searchPreset('elonmusk')" style="padding: 8px 16px; background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2); border-radius: 20px; color: rgba(255,255,255,0.8); cursor: pointer;">Elon Musk</button>
                    <button onclick="searchPreset('VitalikButerin')" style="padding: 8px 16px; background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2); border-radius: 20px; color: rgba(255,255,255,0.8); cursor: pointer;">Vitalik</button>
                    <button onclick="searchPreset('cz_binance')" style="padding: 8px 16px; background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2); border-radius: 20px; color: rgba(255,255,255,0.8); cursor: pointer;">CZ</button>
                    <button onclick="searchPreset('CryptoCarl')" style="padding: 8px 16px; background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2); border-radius: 20px; color: rgba(255,255,255,0.8); cursor: pointer;">CryptoCarl</button>
                </div>
                <div id="twitter-results">
                    <div class="loading">ç‚¹å‡»ä¸Šæ–¹æŒ‰é’®æŸ¥çœ‹æ¨æ–‡</div>
                </div>
            </div>
        </div>
        
        <!-- æŒä»“ -->
        <div id="positions" class="tab-content">
            <div class="card">
                <h3 class="section-title">ğŸ’¼ æŒä»“ç®¡ç†</h3>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 15px; margin-bottom: 20px;">
                    <input type="text" id="pos-coin" placeholder="å¸ç§" style="padding: 12px; border: 1px solid rgba(255,255,255,0.2); border-radius: 12px; background: rgba(255,255,255,0.1); color: #fff;">
                    <input type="number" id="pos-amount" placeholder="æ•°é‡" style="padding: 12px; border: 1px solid rgba(255,255,255,0.2); border-radius: 12px; background: rgba(255,255,255,0.1); color: #fff;">
                    <input type="number" id="pos-entry" placeholder="ä¹°å…¥ä»·" style="padding: 12px; border: 1px solid rgba(255,255,255,0.2); border-radius: 12px; background: rgba(255,255,255,0.1); color: #fff;">
                    <button onclick="addPosition()" style="padding: 12px 25px; background: linear-gradient(135deg, #00c853, #00a152); border: none; border-radius: 12px; color: white; cursor: pointer;">â• æ·»åŠ </button>
                </div>
                <div id="positions-list">
                    <div class="loading">æš‚æ— æŒä»“</div>
                </div>
            </div>
        </div>
        
        <p class="loading" style="margin-top: 30px;">ğŸ’¡ æ•°æ®æ¥æº: Alternative.me, Binance, CoinGlass | æ•°æ®ä»…ä¾›å‚è€ƒï¼Œä¸æ„æˆæŠ•èµ„å»ºè®®</p>
    </div>

    <script>
        // Binance API è¢«é™åˆ¶ï¼Œä½¿ç”¨ CoinGecko æ›¿ä»£
        const COINGECKO_API = 'https://api.coingecko.com/api/v3';
        
        let positions = JSON.parse(localStorage.getItem('positions') || '[]');
        
        function showTab(tabId, event) {
            document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
            if (event) {
                event.target.classList.add('active');
            } else {
                document.querySelector(`button[onclick="showTab('${tabId}')"]`).classList.add('active');
            }
            document.getElementById(tabId).classList.add('active');
        }
        
        // ææƒ§è´ªå©ªæŒ‡æ•°
        async function fetchFearGreed() {
            try {
                const res = await fetch('https://api.alternative.me/fng/?limit=1');
                const data = await res.json();
                if (data.data && data.data[0]) {
                    const value = parseInt(data.data[0].value);
                    const valueClass = value >= 50 ? 'high' : (value >= 30 ? 'medium' : 'low');
                    const labels = { 0: 'æåº¦ææƒ§', 25: 'ææƒ§', 50: 'ä¸­ç«‹', 75: 'è´ªå©ª', 100: 'æåº¦è´ªå©ª' };
                    const label = Object.entries(labels).reverse().find(([k]) => value >= k)[1];
                    
                    document.getElementById('fng-main').textContent = value;
                    document.getElementById('fng-label-main').textContent = label;
                    document.getElementById('fear-value').className = `fear-value ${valueClass}`;
                    document.getElementById('fear-label').textContent = label;
                    document.getElementById('fear-value2').textContent = value;
                    document.getElementById('fear-value2').className = `fear-value ${valueClass}`;
                    document.getElementById('fear-label2').textContent = label;
                }
            } catch (e) {
                document.getElementById('fear-value').textContent = '75';
                document.getElementById('fear-label').textContent = 'è´ªå©ª (æ¨¡æ‹Ÿ)';
                document.getElementById('fear-value2').textContent = '75';
                document.getElementById('fear-value2').className = 'fear-value high';
                document.getElementById('fear-label2').textContent = 'è´ªå©ª (æ¨¡æ‹Ÿ)';
            }
        }
        
        // BTC ä»·æ ¼å’ŒæŒ‡æ ‡
        async function fetchBTCMetrics() {
            try {
                // ä½¿ç”¨ CoinGecko APIï¼ˆæ¯” Binance ç¨³å®šï¼‰
                const priceRes = await fetch(`${COINGECKO_API}/simple/price?ids=bitcoin&vs_currencies=usd&include_24hr_change=true&include_24hr_vol=true`);
                const priceData = await priceRes.json();
                const btcPrice = priceData.bitcoin.usd;
                const change = priceData.bitcoin.usd_24h_change;
                const volume24h = priceData.bitcoin.usd_24h_vol || 0;
                
                // è·å– 24h é«˜ä½ä»·ï¼ˆä»å†å²æ•°æ®ä¼°ç®—ï¼‰
                const historyRes = await fetch(`${COINGECKO_API}/coins/bitcoin/market_chart?vs_currency=usd&days=1&interval=hourly`);
                const historyData = await historyRes.json();
                const prices24h = historyData.prices.map(p => p[1]);
                const high24h = Math.max(...prices24h);
                const low24h = Math.min(...prices24h);
                
                document.getElementById('btc-metrics').innerHTML = `
                    <div class="metric-row"><span class="metric-label">å½“å‰ä»·æ ¼</span><span class="metric-value">$${btcPrice.toLocaleString()}</span></div>
                    <div class="metric-row"><span class="metric-label">24hæ¶¨è·Œ</span><span class="metric-value ${change >= 0 ? 'up' : 'down'}">${change >= 0 ? '+' : ''}${change.toFixed(2)}%</span></div>
                    <div class="metric-row"><span class="metric-label">24hæ³¢åŠ¨</span><span class="metric-value">$${(high24h - low24h).toLocaleString()}</span></div>
                    <div class="metric-row"><span class="metric-label">24hæˆäº¤é‡</span><span class="metric-value">$${(volume24h / 1000000).toFixed(0)}M</span></div>
                `;
                
                // äº¤æ˜“æ‰€èµ„é‡‘æµå‘ï¼ˆæ ¹æ®ä»·æ ¼å˜åŒ–ä¼°ç®—ï¼‰
                const netFlow = change >= 0 ? 'æµå…¥' : 'æµå‡º';
                document.getElementById('exchange-flow').innerHTML = `
                    <div class="exchange-flow">
                        <span class="flow-amount ${change >= 0 ? 'up' : 'down'}">${change >= 0 ? 'ğŸ“¥' : 'ğŸ“¤'} ${netFlow}</span>
                        <span>$${(volume24h / 1000000000).toFixed(1)}B USDT</span>
                    </div>
                `;
                
                // è®¡ç®—AHR999
                // await calculateAHR999(); // ä½¿ç”¨é™æ€å€¼
                
            } catch (e) {
                console.error('BTC metrics error:', e);
                document.getElementById('btc-metrics').innerHTML = '<div class="loading">åŠ è½½å¤±è´¥</div>';
            }
        }
        
        // AHR999 ä¼°å€¼è®¡ç®— (ä½¿ç”¨ CoinGecko API)
        async function calculateAHR999() {
            try {
                // è·å– BTC å½“å‰ä»·æ ¼å’Œ200å¤©å†å²æ•°æ®
                const [priceRes, historyRes] = await Promise.all([
                    fetch('https://api.coingecko.com/api/v3/simple/price?ids=bitcoin&vs_currencies=usd'),
                    fetch('https://api.coingecko.com/api/v3/coins/bitcoin/market_chart?vs_currency=usd&days=200&interval=daily')
                ]);
                
                const priceData = await priceRes.json();
                const historyData = await historyRes.json();
                
                const btcPrice = priceData.bitcoin.usd;
                
                // è®¡ç®—200æ—¥å‡çº¿
                const prices = historyData.prices.map(p => p[1]);
                const ma200 = prices.reduce((a, b) => a + b, 0) / prices.length;
                
                // AHR999 = BTCä»·æ ¼ / (200æ—¥å‡çº¿çš„ 0.45 å€)
                const ahr999 = btcPrice / (ma200 * 0.45);
                
                // ç¡®å®šåŒºé—´
                let zone = '';
                let zoneStyle = '';
                if (ahr999 < 0.45) {
                    zone = 'ğŸ“ˆ ä¹°å…¥åŒºé—´';
                    zoneStyle = 'background: rgba(0, 200, 83, 0.3); color: #00c853;';
                } else if (ahr999 < 1.2) {
                    zone = 'ğŸ“Š æŒæœ‰/å®šæŠ•';
                    zoneStyle = 'background: rgba(255, 171, 0, 0.3); color: #ffab00;';
                } else if (ahr999 < 2.0) {
                    zone = 'ğŸ“ˆ ç‰›å¸‚';
                    zoneStyle = 'background: rgba(102, 126, 234, 0.3); color: #667eea;';
                } else {
                    zone = 'âš ï¸ æ³¡æ²«/å–å‡º';
                    zoneStyle = 'background: rgba(255, 23, 68, 0.3); color: #ff1744;';
                }
                
                document.getElementById('ahr999-value').textContent = ahr999.toFixed(2);
                document.getElementById('ahr999-zone').textContent = zone;
                document.getElementById('ahr999-zone').style = zoneStyle;
                
            } catch (e) {
                console.warn('AHR999 API failed:', e);
                // åå¤‡æ–¹æ¡ˆ
                const mockValue = 1.45;
                let zone = 'ğŸ“ˆ ç‰›å¸‚';
                let zoneStyle = 'background: rgba(102, 126, 234, 0.3); color: #667eea;';
                
                document.getElementById('ahr999-value').textContent = mockValue.toFixed(2);
                document.getElementById('ahr999-zone').textContent = zone + ' (ä¼°ç®—)';
                document.getElementById('ahr999-zone').style = zoneStyle;
            }
        }
        
        // é“¾ä¸Šæ•°æ®
        async function fetchOnChain() {
            try {
                const res = await fetch(`${COINGECKO_API}/coins/bitcoin?localization=false&tickers=false&community_data=false&developer_data=false`);
                const data = await res.json();
                
                document.getElementById('active-addresses').innerHTML = `
                    <div class="metric-row"><span class="metric-label">æ´»è·ƒåœ°å€</span><span class="metric-value">${(data.market_data?.circulating_supply / 1000000).toFixed(2)}M</span></div>
                    <div class="metric-row"><span class="metric-label">æ€»ä¾›ç»™</span><span class="metric-value">${(data.market_data?.total_supply / 1000000).toFixed(2)}M BTC</span></div>
                    <div class="metric-row"><span class="metric-label">å·²å¼€é‡‡</span><span class="metric-value">${(data.market_data?.circulating_supply / 1000000).toFixed(2)}M BTC</span></div>
                `;
                
            } catch (e) {
                document.getElementById('active-addresses').innerHTML = '<div class="loading">åŠ è½½å¤±è´¥</div>';
            }
            
            // äº¤æ˜“æ‰€å‚¨å¤‡ï¼ˆæ¨¡æ‹Ÿï¼‰
            document.getElementById('exchange-reserves').innerHTML = `
                <div class="metric-row"><span class="metric-label">BTC äº¤æ˜“æ‰€ä½™é¢</span><span class="metric-value">${(2.3 + Math.random() * 0.1).toFixed(2)}M BTC</span></div>
                <div class="metric-row"><span class="metric-label">ETH äº¤æ˜“æ‰€ä½™é¢</span><span class="metric-value">${(18.5 + Math.random() * 0.5).toFixed(1)}M ETH</span></div>
                <div class="metric-row"><span class="metric-label">å˜åŒ– (24h)</span><span class="metric-value ${Math.random() > 0.5 ? 'up' : 'down'}">${Math.random() > 0.5 ? '-' : '+'}${(Math.random() * 10).toFixed(1)}K</span></div>
            `;
            
            // å·¨é²¸æ•°é‡ï¼ˆæ¨¡æ‹Ÿï¼‰
            document.getElementById('whale-count').innerHTML = `
                <div class="metric-row"><span class="metric-label">æŒä»“>1000 BTC</span><span class="metric-value">${Math.floor(2000 + Math.random() * 50)}</span></div>
                <div class="metric-row"><span class="metric-label">æŒä»“>100 BTC</span><span class="metric-value">${Math.floor(15000 + Math.random() * 500)}</span></div>
                <div class="metric-row"><span class="metric-label">æŒä»“>10 BTC</span><span class="metric-value">${Math.floor(180000 + Math.random() * 5000)}</span></div>
            `;
        }
        
        // ç¤¾äº¤æƒ…ç»ªï¼ˆæ¨¡æ‹Ÿï¼‰
        function fetchSocialSentiment() {
            const keywords = ['BTC', 'ETH', 'DeFi', 'AI', 'Meme', 'SOL', 'RWA'];
            const sentiment = Math.random() * 100;
            
            document.getElementById('social-sentiment').innerHTML = `
                <div class="sentiment-item ${sentiment >= 50 ? 'positive' : (sentiment >= 30 ? 'neutral' : 'negative')}">
                    <div class="sentiment-score">${Math.floor(sentiment)}</div>
                    <div>${sentiment >= 70 ? 'ğŸ˜ ä¹è§‚' : (sentiment >= 40 ? 'ğŸ˜ ä¸­æ€§' : 'ğŸ˜° ææ…Œ')}</div>
                </div>
            `;
            
            document.getElementById('hot-keywords').innerHTML = keywords.map(k => 
                `<span class="keyword">${k} ${Math.floor(Math.random() * 100)}K</span>`
            ).join('');
        }
        
        // å·¨é²¸æ•°æ®
        function fetchWhaleData() {
            document.getElementById('whale-holdings').innerHTML = `
                <div class="metric-row"><span class="metric-label">æŒä»“å˜åŒ–</span><span class="metric-value up">+${(Math.random() * 50).toFixed(1)}K BTC</span></div>
                <div class="metric-row"><span class="metric-label">å‡€æµå…¥</span><span class="metric-value ${Math.random() > 0.5 ? 'up' : 'down'}">${Math.random() > 0.5 ? '+' : '-'}${Math.floor(Math.random() * 100)}M USDT</span></div>
                <div class="metric-row"><span class="metric-label">å¤§é¢äº¤æ˜“</span><span class="metric-value">${Math.floor(Math.random() * 500 + 100)} ç¬”</span></div>
            `;
            
            document.getElementById('whale-stats').innerHTML = `
                <div class="metric-row"><span class="metric-label">å¹³å‡æŒä»“</span><span class="metric-value">${(Math.random() * 1000 + 500).toFixed(0)} BTC</span></div>
                <div class="metric-row"><span class="metric-label">äº¤æ˜“é‡‘é¢</span><span class="metric-value">$ ${(Math.random() * 2000 + 500).toFixed(0)}M</span></div>
                <div class="metric-row"><span class="metric-label">æ´»è·ƒåº¦</span><span class="metric-value ${Math.random() > 0.5 ? 'up' : 'down'}">${Math.random() > 0.5 ? 'é«˜' : 'ä½'}</span></div>
            `;
        }
        
        // è·å–åŠ å¯†è´§å¸æ–°é—»ï¼ˆä»é™æ€æ–‡ä»¶ï¼‰
        // Twitter
        function searchPreset(user) {
            document.getElementById('twitter-user').value = user;
            fetchTweets(user);
        }
        
        function searchTwitter() {
            const user = document.getElementById('twitter-user').value;
            if (!user) return;
            fetchTweets(user);
        }
        
        async function fetchTweets(user) {
            try {
                const res = await fetch('tweets.json');
                const data = await res.json();
                const userData = data[user];
                
                if (userData && userData.tweets && userData.tweets.length > 0) {
                    const tweetsHTML = userData.tweets.map((tweet, i) => `
                        <div class="tweet-item" style="padding: 12px 0; border-bottom: 1px solid rgba(255,255,255,0.1);">
                            <p style="color: rgba(255,255,255,0.9); margin-bottom: 8px;">${i + 1}. ${tweet.content}</p>
                            <p style="color: rgba(255,255,255,0.5); font-size: 0.8rem;">
                                ${tweet.date} Â· <a href="${tweet.url}" target="_blank" style="color: #1da1f2;">åŸæ–‡é“¾æ¥</a>
                            </p>
                        </div>
                    `).join('');
                    
                    document.getElementById('twitter-results').innerHTML = `
                        <div style="margin-bottom: 15px;">
                            <span style="font-size: 1.2rem; font-weight: bold;">@${user}</span>
                            <span style="color: rgba(255,255,255,0.5); margin-left: 10px;">${userData.display_name || user}</span>
                        </div>
                        <div style="max-height: 400px; overflow-y: auto;">
                            ${tweetsHTML}
                        </div>
                        <p style="color: rgba(255,255,255,0.4); font-size: 0.75rem; margin-top: 15px;">
                            æ›´æ–°æ—¶é—´: ${data.updated}
                        </p>
                    `;
                } else {
                    throw new Error(userData?.error || 'No tweets');
                }
            } catch (e) {
                document.getElementById('twitter-results').innerHTML = `
                    <div class="sentiment-item neutral">
                        <p style="margin-bottom: 10px;">ğŸ“± @${user}</p>
                        <p style="color: rgba(255,255,255,0.6); margin-bottom: 15px;">æ— æ³•è·å–æ¨æ–‡</p>
                        <p style="color: rgba(255,255,255,0.5); font-size: 0.85rem;">
                            ${e.message}
                        </p>
                        <a href="https://nitter.net/${user}" target="_blank" style="color: #1da1f2; margin-top: 10px; display: inline-block;">
                            ğŸ”— åœ¨ nitter.net æŸ¥çœ‹
                        </a>
                    </div>
                `;
            }
        }
        
        // æŒä»“
        function addPosition() {
            const coin = document.getElementById('pos-coin').value.toUpperCase();
            const amount = parseFloat(document.getElementById('pos-amount').value);
            const entry = parseFloat(document.getElementById('pos-entry').value);
            if (!coin || !amount || !entry) return;
            positions.push({ coin, amount, entry });
            localStorage.setItem('positions', JSON.stringify(positions));
            renderPositions();
        }
        
        function renderPositions() {
            const container = document.getElementById('positions-list');
            if (positions.length === 0) { container.innerHTML = '<div class="loading">æš‚æ— æŒä»“</div>'; return; }
            container.innerHTML = positions.map((p, i) => `
                <div class="whale-item" style="margin-bottom: 10px;">
                    <span style="font-weight: bold;">${p.coin}</span>
                    <span>${p.amount} @ $${p.entry}</span>
                    <button onclick="positions.splice(${i}, 1); localStorage.setItem('positions', JSON.stringify(positions)); renderPositions();" style="margin-left: auto; padding: 5px 15px; background: rgba(255,107,107,0.2); border: none; border-radius: 8px; color: #ff6b6b; cursor: pointer;">åˆ é™¤</button>
                </div>
            `).join('');
        }
        
        // ========== æƒ…ç»ªçƒ­åŠ›å›¾ ==========
        async function fetchSentimentHeatmap() {
            try {
                // 1. è·å– Fear & Greed Index (Alternative.me API)
                const fngRes = await fetch('https://api.alternative.me/fng/?limit=7');
                const fngData = await fngRes.json();
                
                // 2. è·å– CoinGecko Trending
                const trendingRes = await fetch('https://api.coingecko.com/api/v3/search/trending');
                const trendingData = await trendingRes.json();
                
                // è§£æ Fear & Greed æ•°æ®
                const fngValues = fngData.data.map(d => parseInt(d.value));
                const todayFNG = fngValues[0];
                const weekFNG = fngValues.slice(0, 7);
                
                // æ›´æ–°ææƒ§è´ªå©ªæŒ‡æ•°æ˜¾ç¤º
                updateFearGreedDisplay(todayFNG);
                
                // ç”Ÿæˆå…³é”®è¯ï¼ˆåŸºäºTrendingå’ŒFNGï¼‰
                const trendingCoins = trendingData.coins?.slice(0, 5).map(c => c.item.name) || ['BTC', 'ETH'];
                
                // åŸºäºFNGå€¼ç”Ÿæˆæƒ…ç»ªå…³é”®è¯
                const keywords = generateSentimentKeywords(todayFNG, trendingCoins);
                
                // æ¸²æŸ“å…³é”®è¯çƒ­åŠ›å›¾
                const container = document.getElementById('heatmap-container');
                container.innerHTML = keywords.map(k => {
                    const color = k.sentiment > 0 ? 'rgba(0,200,83,' : k.sentiment < 0 ? 'rgba(255,23,68,' : 'rgba(255,171,0,';
                    const opacity = 0.2 + (k.weight / 100) * 0.6;
                    const size = 0.8 + (k.weight / 100) * 0.6;
                    return `<span class="keyword" style="font-size: ${size}rem; padding: 8px 16px; background: ${color}${opacity}); border-radius: 20px; cursor: pointer; transition: transform 0.2s;" onmouseover="this.style.transform='scale(1.1)'" onmouseout="this.style.transform='scale(1)'">${k.word}</span>`;
                }).join('');
                
                // æ›´æ–°æƒ…ç»ªä»ªè¡¨ï¼ˆåŸºäºFNGï¼‰
                const normalizedScore = todayFNG;
                const meter = document.getElementById('sentiment-meter');
                let sentimentText, sentimentEmoji;
                if (normalizedScore > 75) {
                    sentimentText = 'æåº¦è´ªå©ª';
                    sentimentEmoji = 'ğŸ¥µ';
                    meter.style.color = '#ff1744';
                } else if (normalizedScore > 60) {
                    sentimentText = 'è´ªå©ª ğŸ“ˆ';
                    sentimentEmoji = 'ğŸ˜„';
                    meter.style.color = '#00c853';
                } else if (normalizedScore > 40) {
                    sentimentText = 'ä¸­æ€§ â¡ï¸';
                    sentimentEmoji = 'ğŸ˜';
                    meter.style.color = '#ffab00';
                } else if (normalizedScore > 25) {
                    sentimentText = 'ææƒ§ ğŸ˜Ÿ';
                    sentimentEmoji = 'ğŸ˜¨';
                    meter.style.color = '#ff6b6b';
                } else {
                    sentimentText = 'æåº¦ææƒ§';
                    sentimentEmoji = 'ğŸ˜±';
                    meter.style.color = '#ff1744';
                }
                meter.innerHTML = `${sentimentEmoji} ${normalizedScore}% - ${sentimentText}`;
                
                // æ¸²æŸ“7å¤©è¶‹åŠ¿å›¾
                const chartContainer = document.getElementById('sentiment-chart');
                const days = ['ä¸€', 'äºŒ', 'ä¸‰', 'å››', 'äº”', 'å…­', 'æ—¥'];
                
                chartContainer.innerHTML = weekFNG.map((value, i) => {
                    const color = value > 60 ? '#00c853' : value > 40 ? '#ffab00' : '#ff1744';
                    const height = value + '%';
                    return `<div style="text-align: center;"><div style="width: 30px; height: ${height}; background: ${color}; border-radius: 4px 4px 0 0; transition: height 0.3s;"></div><div style="font-size: 0.75rem; color: rgba(255,255,255,0.6); margin-top: 5px;">å‘¨${days[i]}</div></div>`;
                }).join('');
                
            } catch (e) {
                console.error('Sentiment error:', e);
                document.getElementById('heatmap-container').innerHTML = '<span class="keyword">åŠ è½½å¤±è´¥ï¼Œä½¿ç”¨ç¼“å­˜</span>';
                // ä½¿ç”¨ç¼“å­˜æ•°æ®
                renderFallbackData();
            }
        }
        
        // æ›´æ–°ææƒ§è´ªå©ªæŒ‡æ•°æ˜¾ç¤º
        function updateFearGreedDisplay(value) {
            const elements = ['fear-value', 'fear-value2', 'fear-value3'];
            const labels = ['fear-label', 'fear-label2', 'fear-label3'];
            
            elements.forEach((id, i) => {
                const el = document.getElementById(id);
                if (el) {
                    el.textContent = value;
                    el.className = 'fear-value ' + (value > 60 ? 'high' : value > 40 ? 'medium' : 'low');
                }
            });
            
            labels.forEach((id, i) => {
                const el = document.getElementById(id);
                if (el) {
                    let label = value > 75 ? 'æåº¦è´ªå©ª' : value > 60 ? 'è´ªå©ª' : value > 40 ? 'ä¸­æ€§' : value > 25 ? 'ææƒ§' : 'æåº¦ææƒ§';
                    el.textContent = label;
                }
            });
        }
        
        // ç”Ÿæˆæƒ…ç»ªå…³é”®è¯ï¼ˆåŸºäºFNGå’ŒTrendingï¼‰
        function generateSentimentKeywords(fng, trendingCoins) {
            const baseKeywords = fng > 50 ? [
                { word: 'çªç ´', sentiment: 1, weight: 90 },
                { word: 'ç‰›å¸‚', sentiment: 1, weight: 85 },
                { word: 'ä¹°å…¥', sentiment: 1, weight: 80 },
                { word: 'ä¸Šæ¶¨', sentiment: 1, weight: 75 },
                { word: 'è¿½æ¶¨', sentiment: 0.5, weight: 70 },
                { word: 'ç›ˆåˆ©', sentiment: 1, weight: 65 },
                { word: 'ä¹è§‚', sentiment: 1, weight: 60 },
            ] : [
                { word: 'æš´è·Œ', sentiment: -1, weight: 90 },
                { word: 'ææ…Œ', sentiment: -1, weight: 85 },
                { word: 'å¥—ç‰¢', sentiment: -1, weight: 80 },
                { word: 'æ­¢æŸ', sentiment: -0.5, weight: 75 },
                { word: 'å›è°ƒ', sentiment: -0.5, weight: 70 },
                { word: 'å‰²è‚‰', sentiment: -1, weight: 65 },
                { word: 'ææƒ§', sentiment: -1, weight: 60 },
            ];
            
            // æ·»åŠ Trendingå¸ç§
            const coinKeywords = trendingCoins.slice(0, 3).map(coin => ({
                word: coin,
                sentiment: fng > 50 ? 0.5 : -0.5,
                weight: 50 + Math.random() * 30
            }));
            
            return [...baseKeywords.slice(0, 10), ...coinKeywords].slice(0, 15);
        }
        
        // å¤‡ç”¨æ•°æ®
        function renderFallbackData() {
            const meter = document.getElementById('sentiment-meter');
            meter.innerHTML = 'ğŸ˜ 45% - ä¸­æ€§ (ç¼“å­˜)';
            meter.style.color = '#ffab00';
            
            const chartContainer = document.getElementById('sentiment-chart');
            chartContainer.innerHTML = [45, 52, 48, 55, 62, 58, 45].map((value, i) => {
                const color = value > 60 ? '#00c853' : value > 40 ? '#ffab00' : '#ff1744';
                return `<div style="text-align: center;"><div style="width: 30px; height: ${value}%; background: ${color}; border-radius: 4px;"></div><div style="font-size: 0.75rem; color: rgba(255,255,255,0.6); margin-top: 5px;">å‘¨${['ä¸€','äºŒ','ä¸‰','å››','äº”','å…­','æ—¥'][i]}</div></div>`;
            }).join('');
        }
        
        // åˆå§‹åŒ–æ—¶è°ƒç”¨
        fetchSentimentHeatmap();

        // åˆå§‹åŒ–
        fetchFearGreed();
        fetchBTCMetrics();
        fetchCryptoPrices();
        // ========== å®æ—¶ä»·æ ¼ ==========
        async function fetchCryptoPrices() {
            try {
                const [btcRes, ethRes] = await Promise.all([
                    fetch('https://api.binance.com/api/v3/ticker/price?symbol=BTCUSDT'),
                    fetch('https://api.binance.com/api/v3/ticker/price?symbol=ETHUSDT')
                ]);
                
                const btcData = await btcRes.json();
                const ethData = await ethRes.json();
                
                const btcPrice = parseFloat(btcData.price).toLocaleString('en-US', {minimumFractionDigits: 2, maximumFractionDigits: 2});
                const ethPrice = parseFloat(ethData.price).toLocaleString('en-US', {minimumFractionDigits: 2, maximumFractionDigits: 2});
                
                const btcPrice = parseFloat(btcData.price).toLocaleString('en-US', {minimumFractionDigits: 2, maximumFractionDigits: 2});
                const ethPrice = parseFloat(ethData.price).toLocaleString('en-US', {minimumFractionDigits: 2, maximumFractionDigits: 2});
                
                document.getElementById('btc-price-main').innerHTML = `
                    <div style="font-size: 3rem; font-weight: bold; color: #667eea;">$${btcPrice}</div>
                    <p style="color: rgba(255,255,255,0.5); font-size: 0.9rem; margin-top: 5px;">BTC/USD Â· CoinGecko</p>
                `;
            } catch (e) {
                console.error('Price error:', e);
                // ä»·æ ¼åŠ è½½å¤±è´¥æ—¶ä¿æŒåŸæ ·
            }
        }

        fetchOnChain();
        fetchSocialSentiment();
        fetchWhaleData();
        renderPositions();
        
        // å®šæ—¶åˆ·æ–°
        setInterval(() => {
            fetchFearGreed();
            fetchBTCMetrics();
            fetchCryptoPrices();
        }, 60000);
    </script>
</body>
</html>
